# Планирование IPv4-сетей АО "Рога и копыта"

## Описание методики
Так как смена нумерации сети является довольно болезненной процедурой и крайне редко проходит без тяжёлых эксцессов, планированию сети необходимо уделять особое внимание. Заложенная архитектура сети должна предполагать безболезненное масштабирование на протяжении 5 лет и, в случае необходимости, максимально простое расширение предопределённого диапазона или постепенный переход на новую нумерацию, если потребуется.

При выборе IP-диапазонов следует исходить из следующих правил:
1. Сеть должна требовать минимума правил настройки маршрутизации, включая сегменты, маршрутизация которых должна быть максимально ограниченной. 
2. Должна обеспечиваться возможность настраивать правила фильтрации межсетевого экрана (Firewall) методом минимально возможных доступов (разрешать подключения только по разрешённым портам и только из разрешённых IP-подсетей)
3. Количество IP-блоков должно быть не меньше, чем существует функциональных ролей участников сети, чтобы обеспечивалась возможность обеспечить носителей каждой роли выделенным блоком адресов и, соответственно, обощёнными настройками маршрутизации и фильтрации трафика.

## Детализированный план
Для работы внутренней сети компании используется два блока IP-адресов:
1. 172.16.0.0/16 для общего взаимодействия внутренних подсистем
2. 192.168.0.0/20 для организации транзитных сетей.

При исчерпании запаса IP-адресов предполагается постепенное расширение исходных диапазонов сначала до /15, затем до /14, /13, /12 для общих сетей и, соответственно, /19, /18, /17 и /16 для транзитных.

Мы разделяем все площадки размещения оборудования компании на 2 класса: 
1. __офисы__. Под офисами мы подразумеваем географически локализованную часть сети, снабжённую минимально необходимым для доступа к сети Интернет и другим площадкам компании набором базовых служб (DHCP, DNS, NTP, LDAP, VPN, Printing services) и предназначенную для обеспечения доступа к сети рабочих станций сотрудников и гостей компании.
2. __дата-центры__. Под датацентрами мы подразумеваем географически локализованную часть сети, предназначенную исключительно для работы корпоративных серверных систем. То есть, если в офисе компании есть не только рабочие станции сотрудников, но и, например, ферма серверов для развёртывания демонстрационных версий программных продуктов, в данном офисе необходимо выделить так же логический дата-центр, имеющий собственные адресацию и комплект базовых служб сети.

Для каждого типа локаций выделяются равнозначные блоки /17 (/21 для транзитных сетей).

Для каждой новой площадки мы выделяем два диапазона адресов: блок /21 для основных нужд сети и блок /25 для организации транзитных сетей. При этом каждый новых блок мы выделяем в начале соответствующего свободного диапазона /19 (/23 для транзитных сетей), чтобы обеспечить возможность масштабирования уже имеющихся сетей. В случае исчерпания всех свободных блоков /17 мы начинаем постепенно выбирать один из уже занятых блоков, сеть которого, по прогнозам компании и ИТ-подразделения будет разрастаться с наименьшей вероятностью.

## Примеры
Для внутренней сети компании выделены следующие диапазоны:
* 172.16.0.0/16 для основных нужд.
* 192.168.0.0/20 для обеспечения транзитных сетей.

В случае исчерпания адресного пространства полагается захват следующего блока IP-адресов и, соответственно, удвоение ёмкости для IP-адресации. При этом маска подсети становится меньше на единицу (/16 -> /15 -> /14 и т.д.)

Для офисов выделен блок 172.16.0.0/17 (транзитные сети из блока 192.168.0.0/21). Соответственно, для дата-центров выделены блоки 172.16.128.0/17 (транзитные сети 192.168.8.0/21).

Головной офис компании располагается в Мурманске. Серверы размещаются в головном офисе (бизнес-инструментарий, тестовая площадка), в Москве (основная продуктивная площадка) и Санкт-Петербурге (резрервная продуктивная площадка). В течение ближайших двух лет компания планирует переезд головного офиса в другую часть Мурманска, открытие дополнительного офиса в Хабаровске и внедрение площадки серверов для публичного бета-тестирования корпоративных сервисов (Москва). Результирующая таблица IP-адресации компании выглядит так:

|      /16      |       /17       |       /19       |       /20       |       /21       |        /25        |       Площадка        |     Фунция     |
|---------------|-----------------|-----------------|-----------------|-----------------|-------------------|-----------------------|----------------|
| 172.16.0.0/16 |                 |                 |                 |                 |                   |                       |                |
|               |  172.16.0.0/17  |                 |                 |                 |                   | Офисы                 |                |
|               |                 | 172.16.0.0/19   |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.0.0/20   |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.0.0/21   |                   | Мурманск-1            |                |
|               |                 |                 |                 | 172.16.8.0/21   |                   |                       |                |
|               |                 |                 | 172.16.16.0/20  |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.16.0/21  |                   |                       |                |
|               |                 |                 |                 | 172.16.24.0/21  |                   |                       |                |
|               |                 | 172.16.32.0/19  |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.32.0/20  |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.32.0/21  |                   | Мурманск-2            |                |
|               |                 |                 |                 | 172.16.40.0/21  |                   |                       |                |
|               |                 |                 | 172.16.48.0/20  |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.48.0/21  |                   |                       |                |
|               |                 |                 |                 | 172.16.56.0/21  |                   |                       |                |
|               |                 | 172.16.64.0/19  |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.64.0/20  |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.64.0/21  |                   | Хабаровск-1           |                |
|               |                 |                 |                 | 172.16.72.0/21  |                   |                       |                |
|               |                 |                 | 172.16.80.0/20  |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.80.0/21  |                   |                       |                |
|               |                 |                 |                 | 172.16.88.0/21  |                   |                       |                |
|               |                 | 172.16.96.0/19  |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.96.0/20  |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.96.0/21  |                   |                       |                |
|               |                 |                 |                 | 172.16.104.0/21 |                   |                       |                |
|               |                 |                 | 172.16.112.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.112.0/21 |                   |                       |                |
|               |                 |                 |                 | 172.16.120.0/21 |                   |                       |                |
|               | 172.16.128.0/17 |                 |                 |                 |                   | Дата-центры           |                |
|               |                 | 172.16.128.0/19 |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.128.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.128.0/21 |                   | Мурманск-1            |                |
|               |                 |                 |                 | 172.16.136.0/21 |                   |                       |                |
|               |                 |                 | 172.16.144.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.144.0/21 |                   | Москва-2              |                |
|               |                 |                 |                 | 172.16.152.0/21 |                   |                       |                |
|               |                 | 172.16.160.0/19 |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.160.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.160.0/21 |                   | Москва-1              |                |
|               |                 |                 |                 | 172.16.168.0/21 |                   |                       |                |
|               |                 |                 | 172.16.176.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.176.0/21 |                   |                       |                |
|               |                 |                 |                 | 172.16.184.0/21 |                   |                       |                |
|               |                 | 172.16.192.0/19 |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.192.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.192.0/21 |                   | Санкт-Петербург-1     |                |
|               |                 |                 |                 | 172.16.200.0/21 |                   |                       |                |
|               |                 |                 | 172.16.208.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.208.0/21 |                   |                       |                |
|               |                 |                 |                 | 172.16.216.0/21 |                   |                       |                |
|               |                 | 172.16.224.0/19 |                 |                 |                   |                       |                |
|               |                 |                 | 172.16.224.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.224.0/21 |                   | Мурманск-2            |                |
|               |                 |                 |                 | 172.16.232.0/21 |                   |                       |                |
|               |                 |                 | 172.16.240.0/20 |                 |                   |                       |                |
|               |                 |                 |                 | 172.16.240.0/21 |                   |                       |                |
|               |                 |                 |                 | 172.16.248.0/21 |                   |                       |                |
|ххххххххххххххх|ххххххххххххххххх|ххххххххххххххххх|ххххххххххххххххх|ххххххххххххххххх|ххххххххххххххххххх|ххххххххххххххххххххххх|хххххххххххххххх|
|               |                 |                 |                 | 192.168.0.0/21  |                   |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.0.0/25    | Мурманск-офис-1       | Транзит        |
|               |                 |                 |                 |                 | 192.168.0.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.1.0/25    | Мурманск-дц-1         | Транзит        |
|               |                 |                 |                 |                 | 192.168.1.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.2.0/25    | Москва-дц-1           | Транзит        |
|               |                 |                 |                 |                 | 192.168.2.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.3.0/25    | Санкт-Петербург--дц-1 | Транзит        |
|               |                 |                 |                 |                 | 192.168.3.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.4.0/25    | Мурманск-офис-2       | Транзит        |
|               |                 |                 |                 |                 | 192.168.4.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.5.0/25    | Хабаровск-офис-1      | Транзит        |
|               |                 |                 |                 |                 | 192.168.5.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.6.0/25    | Москва-дц-2           | Транзит        |
|               |                 |                 |                 |                 | 192.168.6.128/25  |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.7.0/25    |                       | Транзит        |
|               |                 |                 |                 |                 | 192.168.7.128/25  |                       | Транзит        |
